-- ======================================
-- X I E H U B  - LETTER FADE (X FIRST)
-- ======================================

local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")

local gui = Instance.new("ScreenGui")
gui.Name = "XieHubIntro"
gui.IgnoreGuiInset = true
gui.ResetOnSpawn = false
gui.Parent = CoreGui

local holder = Instance.new("Frame", gui)
holder.AnchorPoint = Vector2.new(0.5, 0.5)
holder.Position = UDim2.fromScale(0.5, 0.5)
holder.Size = UDim2.fromScale(0.4, 0.15)
holder.BackgroundTransparency = 1

local text = "XieHub"
local letters = {}

-- BUAT LABEL PER HURUF (URUT NORMAL)
for i = 1, #text do
    local char = text:sub(i, i)

    local lbl = Instance.new("TextLabel")
    lbl.BackgroundTransparency = 1
    lbl.Text = char
    lbl.TextTransparency = 1
    lbl.TextStrokeTransparency = 1
    lbl.TextColor3 = Color3.fromRGB(190, 130, 255)
    lbl.Font = Enum.Font.GothamBold
    lbl.TextScaled = true
    lbl.Size = UDim2.fromScale(0.12, 1)
    lbl.Parent = holder

    -- GLOW UNGU
    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.fromRGB(180, 100, 255)
    stroke.Thickness = 2
    stroke.Transparency = 1
    stroke.Parent = lbl

    table.insert(letters, lbl)
end

-- POSISI RAPIH (TENGAH)
task.wait()
for i, lbl in ipairs(letters) do
    lbl.Position = UDim2.fromScale(
        0.5 - (#letters * 0.12) / 2 + (i - 1) * 0.12,
        0
    )
end

-- ANIMASI: X â†’ i â†’ e â†’ H â†’ u â†’ b
for _, lbl in ipairs(letters) do
    TweenService:Create(lbl, TweenInfo.new(
        0.35,
        Enum.EasingStyle.Quad,
        Enum.EasingDirection.Out
    ), {
        TextTransparency = 0,
        TextStrokeTransparency = 0.6
    }):Play()

    local stroke = lbl:FindFirstChildOfClass("UIStroke")
    if stroke then
        TweenService:Create(stroke, TweenInfo.new(0.35), {
            Transparency = 0.3
        }):Play()
    end

    task.wait(0.09)
end

task.wait(0.9)

-- FADE OUT SEMUA
for _, lbl in ipairs(letters) do
    TweenService:Create(lbl, TweenInfo.new(0.35), {
        TextTransparency = 1,
        TextStrokeTransparency = 1
    }):Play()
end

task.wait(0.4)
gui:Destroy()

-- LOAD KAVO UI
local Library = loadstring(game:HttpGetAsync(
    "https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"
))()
local Window = Library.CreateLib("Dixxie Hub", "DarkTheme")

-- ======================================
-- SERVICES
-- ======================================
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService") -- ðŸ”§ WAJIB
local player = Players.LocalPlayer

-- ======================================
-- GET KAVO MAIN FRAME (WAJIB)
-- ======================================
task.wait(0.5)

local KavoFrame
for _, gui in ipairs(game.CoreGui:GetChildren()) do
    if gui:IsA("ScreenGui") then
        for _, v in ipairs(gui:GetDescendants()) do
            if v:IsA("Frame") and v.Name == "Main" then
                KavoFrame = v
                break
            end
        end
    end
end

if not KavoFrame then
    warn("âŒ Kavo Main Frame not found")
    return
end

-- ======================================
-- PURPLE OUTLINE KAVO UI
-- ======================================
do
    local old = KavoFrame:FindFirstChild("XieHubOutline")
    if old then old:Destroy() end

    local stroke = Instance.new("UIStroke")
    stroke.Name = "XieHubOutline"
    stroke.Color = Color3.fromRGB(160, 90, 220)
    stroke.Thickness = 2
    stroke.Transparency = 0.2
    stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    stroke.Parent = KavoFrame

    if not KavoFrame:FindFirstChildOfClass("UICorner") then
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 10)
        corner.Parent = KavoFrame
    end
end

-- ======================================
-- HEADER KAVO UI - DARK PURPLE (FIXED)
-- ======================================
task.wait(0.2)

for _, v in ipairs(KavoFrame:GetDescendants()) do
    if v:IsA("TextLabel") and v.Text == "Dixxie Hub" then
        v.Font = Enum.Font.Montserrat
        v.TextTransparency = 0
        v.TextColor3 = Color3.fromRGB(65, 30, 105)

        local s = v:FindFirstChildOfClass("UIStroke")
        if s then s:Destroy() end
        break
    end
end

-- ======================================
-- SECTION BAR (ESP / AUTO) â†’ DARK PURPLE
-- ======================================

local SECTION_BG   = Color3.fromRGB(45, 20, 70)   -- dark purple
local SECTION_TEXT = Color3.fromRGB(210, 170, 255)

task.spawn(function()
    while task.wait(0.4) do
        if not KavoFrame or not KavoFrame.Parent then break end

        for _, v in ipairs(KavoFrame:GetDescendants()) do
            -- JUDUL SECTION (ESP, AUTO, dll)
            if v:IsA("TextLabel") then
                -- ciri section bar: text besar + parent Frame abu-abu
                local p = v.Parent
                if p and p:IsA("Frame")
                and p.BackgroundColor3.R > 60 -- filter bar abu
                and v.TextSize >= 14 then

                    -- WARNA BAR
                    p.BackgroundColor3 = SECTION_BG
                    p.BackgroundTransparency = 0

                    -- WARNA TEKS
                    v.TextColor3 = SECTION_TEXT
                    v.Font = Enum.Font.Montserrat

                    -- HILANGKAN STROKE LAMA
                    local s = p:FindFirstChildOfClass("UIStroke")
                    if s then s:Destroy() end
                end
            end
        end
    end
end)

-- ======================================
-- FLOATING ICON + MINIMIZE KAVO UI (FINAL CLEAN)
-- ======================================

local CoreGui = game:GetService("CoreGui")
local UIS = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

local FloatGui = Instance.new("ScreenGui")
FloatGui.Name = "XieHub_FloatingIcon"
FloatGui.ResetOnSpawn = false
FloatGui.Parent = CoreGui

local FloatBtn = Instance.new("ImageButton")
FloatBtn.Size = UDim2.fromOffset(56, 56)
FloatBtn.Position = UDim2.fromScale(0.12, 0.5)
FloatBtn.BackgroundColor3 = Color3.fromRGB(40, 30, 60)
FloatBtn.BorderSizePixel = 0
FloatBtn.Image = "rbxassetid://139137924883238"
FloatBtn.ImageColor3 = Color3.fromRGB(200, 150, 255)
FloatBtn.ZIndex = 999
FloatBtn.Parent = FloatGui

Instance.new("UICorner", FloatBtn).CornerRadius = UDim.new(1, 0)

local stroke = Instance.new("UIStroke")
stroke.Color = Color3.fromRGB(180, 120, 255)
stroke.Thickness = 2
stroke.Transparency = 0.25
stroke.Parent = FloatBtn

-- Hover
FloatBtn.MouseEnter:Connect(function()
    TweenService:Create(FloatBtn, TweenInfo.new(0.15), {
        Size = UDim2.fromOffset(60, 60)
    }):Play()
end)

FloatBtn.MouseLeave:Connect(function()
    TweenService:Create(FloatBtn, TweenInfo.new(0.15), {
        Size = UDim2.fromOffset(56, 56)
    }):Play()
end)

-- Drag
local dragging, dragStart, startPos
FloatBtn.InputBegan:Connect(function(i)
    if i.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = i.Position
        startPos = FloatBtn.Position
        i.Changed:Connect(function()
            if i.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

UIS.InputChanged:Connect(function(i)
    if dragging and i.UserInputType == Enum.UserInputType.MouseMovement then
        local d = i.Position - dragStart
        FloatBtn.Position = UDim2.new(
            startPos.X.Scale, startPos.X.Offset + d.X,
            startPos.Y.Scale, startPos.Y.Offset + d.Y
        )
    end
end)

-- ================= MINIMIZE / RESTORE =================
local minimized = false
task.wait(0.2)
local originalSize = KavoFrame.Size

local function minimize()
    minimized = true
    TweenService:Create(KavoFrame, TweenInfo.new(0.25), {
        Size = UDim2.new(originalSize.X.Scale, originalSize.X.Offset, 0, 0)
    }):Play()

    task.delay(0.25, function()
        if minimized then
            KavoFrame.Visible = false
        end
    end)
end

local function restore()
    minimized = false
    KavoFrame.Visible = true
    KavoFrame.Size = UDim2.new(originalSize.X.Scale, originalSize.X.Offset, 0, 0)

    TweenService:Create(KavoFrame, TweenInfo.new(0.25), {
        Size = originalSize
    }):Play()
end

FloatBtn.MouseButton1Click:Connect(function()
    if minimized then
        restore()
    else
        minimize()
    end
end)

-- AUTO REMOVE FLOATING SAAT KAVO CLOSE
task.spawn(function()
    while task.wait(0.4) do
        if not KavoFrame
        or not KavoFrame.Parent
        or not KavoFrame:IsDescendantOf(CoreGui) then
            FloatGui:Destroy()
            break
        end
    end
end)

-- ======================================
-- UNIVERSAL DRAG (MOUSE + TOUCH)
-- ======================================
local UIS = game:GetService("UserInputService")

local function MakeDraggable(guiObject)
    local dragging = false
    local dragInput
    local dragStart
    local startPos

    local function update(input)
        local delta = input.Position - dragStart
        guiObject.Position = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
    end

    guiObject.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1
        or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = guiObject.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    guiObject.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement
        or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)

    UIS.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            update(input)
        end
    end)
end

-- ======================================
-- PLAYER TAB
-- ======================================
local PlayerTab = Window:NewTab("Player")
local PlayerSection = PlayerTab:NewSection("Movement")

local BASE_SPEED, speedMultiplier = 16, 1
local BASE_JUMP, jumpMultiplier = 50, 1
local flying, flySpeed = false, 60
local bodyGyro, bodyVelocity, flyConn

-- WALKSPEED
PlayerSection:NewSlider("WalkSpeed", "Speed x", 10, 1, function(v)
    speedMultiplier = v
end)

-- JUMP
PlayerSection:NewSlider("Jump Power", "Jump x", 10, 1, function(v)
    jumpMultiplier = v
end)

-- APPLY SPEED & JUMP (1 LOOP SAJA â€“ RINGAN)
RunService.Heartbeat:Connect(function()
    local char = player.Character
    local hum = char and char:FindFirstChildOfClass("Humanoid")
    if hum then
        hum.WalkSpeed = BASE_SPEED * speedMultiplier
        hum.JumpPower = BASE_JUMP * jumpMultiplier
    end
end)

-- FLY
local function startFly()
    local char = player.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    bodyGyro = Instance.new("BodyGyro", hrp)
    bodyGyro.P = 90000
    bodyGyro.MaxTorque = Vector3.new(9e9,9e9,9e9)

    bodyVelocity = Instance.new("BodyVelocity", hrp)
    bodyVelocity.MaxForce = Vector3.new(9e9,9e9,9e9)

    flyConn = RunService.RenderStepped:Connect(function()
        local cam = workspace.CurrentCamera
        bodyGyro.CFrame = cam.CFrame

        local dir = Vector3.zero
        if UIS:IsKeyDown(Enum.KeyCode.W) then dir += cam.CFrame.LookVector end
        if UIS:IsKeyDown(Enum.KeyCode.S) then dir -= cam.CFrame.LookVector end
        if UIS:IsKeyDown(Enum.KeyCode.A) then dir -= cam.CFrame.RightVector end
        if UIS:IsKeyDown(Enum.KeyCode.D) then dir += cam.CFrame.RightVector end
        if UIS:IsKeyDown(Enum.KeyCode.Space) then dir += Vector3.yAxis end
        if UIS:IsKeyDown(Enum.KeyCode.LeftShift) then dir -= Vector3.yAxis end

        bodyVelocity.Velocity = dir.Magnitude > 0 and dir.Unit * flySpeed or Vector3.zero
    end)
end

local function stopFly()
    if flyConn then flyConn:Disconnect() end
    if bodyGyro then bodyGyro:Destroy() end
    if bodyVelocity then bodyVelocity:Destroy() end
end

PlayerSection:NewButton("Fly", "Toggle Fly", function()
    flying = not flying
    if flying then startFly() else stopFly() end
end)

PlayerSection:NewSlider("Fly Speed", "Fly Speed x", 100, 10, function(v)
    flySpeed = v
end)

-- NOCLIP
local noclip = false
RunService.Stepped:Connect(function()
    if not noclip then return end
    local char = player.Character
    if char then
        for _, v in ipairs(char:GetDescendants()) do
            if v:IsA("BasePart") then
                v.CanCollide = false
            end
        end
    end
end)

PlayerSection:NewButton("NoClip", "Toggle NoClip", function()
    noclip = not noclip
end)

-- ======================================
-- MAIN TAB (ESP MM2)
-- ======================================
local MainTab = Window:NewTab("Main")
local MainSection = MainTab:NewSection("ESP")

local espEnabled = false
local espCache = {}

local function createESP(char)
    if not char or char:FindFirstChild("DixxieESP") then return end

    local h = Instance.new("Highlight")
    h.Name = "DixxieESP"
    h.FillTransparency = 0.5
    h.OutlineTransparency = 0
    h.Parent = char
end

local function removeESP(plr)
    if espCache[plr] then
        espCache[plr] = nil
    end
    if plr.Character then
        local h = plr.Character:FindFirstChild("DixxieESP")
        if h then h:Destroy() end
    end
end

local function applyESP(plr)
    if plr == player then return end
    if not espEnabled then return end

    if plr.Character then
        createESP(plr.Character)
    end

    -- AUTO UPDATE SAAT RESPAWN / ROUND BARU
    plr.CharacterAdded:Connect(function(char)
        task.wait(0.2)
        if espEnabled then
            createESP(char)
        end
    end)

    espCache[plr] = true
end

local function clearESP()
    for _, plr in ipairs(Players:GetPlayers()) do
        removeESP(plr)
    end
    table.clear(espCache)
end

-- TOGGLE ESP
MainSection:NewToggle("ESP Player", "MM2 Player ESP (Auto Update)", function(state)
    espEnabled = state

    if state then
        for _, plr in ipairs(Players:GetPlayers()) do
            applyESP(plr)
        end
    else
        clearESP()
    end
end)

-- PLAYER JOIN / LEAVE AUTO HANDLE
Players.PlayerAdded:Connect(function(plr)
    if espEnabled then
        applyESP(plr)
    end
end)

Players.PlayerRemoving:Connect(function(plr)
    removeESP(plr)
end)

-- UPDATE WARNA ROLE (REALTIME)
RunService.Heartbeat:Connect(function()
    if not espEnabled then return end

    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= player and plr.Character then
            local h = plr.Character:FindFirstChild("DixxieESP")
            if not h then continue end

            -- ðŸ”´ MURDER
            if plr.Backpack:FindFirstChild("Knife")
            or plr.Character:FindFirstChild("Knife") then
                h.FillColor = Color3.fromRGB(255, 0, 0)
                h.OutlineColor = Color3.fromRGB(255, 0, 0)

            -- ðŸ”µ SHERIFF
            elseif plr.Backpack:FindFirstChild("Gun")
            or plr.Character:FindFirstChild("Gun") then
                h.FillColor = Color3.fromRGB(0, 120, 255)
                h.OutlineColor = Color3.fromRGB(0, 120, 255)

            -- ðŸŸ¢ INNOCENT
            else
                h.FillColor = Color3.fromRGB(0, 255, 0)
                h.OutlineColor = Color3.fromRGB(0, 255, 0)
            end
        end
    end
end)

-- =====================================
-- AUTO AIM SHERIFF (HOLD GUN ONLY)
-- ======================================
local MainSection = MainTab:NewSection("AIM")

local autoAimSheriff = false

MainSection:NewToggle(
    "Auto Aim Sheriff",
    "Auto aim saat memegang pistol",
    function(state)
        autoAimSheriff = state
    end
)

local Camera = workspace.CurrentCamera

local function isHoldingGun()
    return (player.Character and player.Character:FindFirstChild("Gun"))
end

local function getMurderer()
    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= player and plr.Character then
            if plr.Character:FindFirstChild("Knife") then
                return plr
            end
        end
    end
end

-- ======================================
-- MM2 MURDER LOCK AIMBOT (RIGHT CLICK)
-- ======================================

local Camera = workspace.CurrentCamera
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer

local Holding = false

-- =========================
-- CONFIG (JANGAN DIUBAH)
-- =========================
_G.AimbotEnabled = true
_G.TeamCheck = false
_G.AimPart = "UpperTorso" -- ganti "HumanoidRootPart" kalau mau
_G.Sensitivity = 0        -- 0 = instant lock

-- =========================
-- DETEKSI MURDER (MM2 FIX)
-- =========================
local function IsMurderer(plr)
    if not plr then return false end

    -- CEK TOOL DI CHARACTER
    if plr.Character then
        for _,v in ipairs(plr.Character:GetChildren()) do
            if v:IsA("Tool") and v.Name == "Knife" then
                return true
            end
        end
    end

    -- CEK TOOL DI BACKPACK
    if plr:FindFirstChild("Backpack") then
        for _,v in ipairs(plr.Backpack:GetChildren()) do
            if v:IsA("Tool") and v.Name == "Knife" then
                return true
            end
        end
    end

    return false
end

-- =========================
-- CARI MURDER TERDEKAT KE CROSSHAIR
-- =========================
local function GetClosestMurder()
    local closest
    local shortest = math.huge
    local mousePos = UserInputService:GetMouseLocation()

    for _,plr in ipairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and IsMurderer(plr) and plr.Character then
            local part = plr.Character:FindFirstChild(_G.AimPart)
            local hum = plr.Character:FindFirstChildOfClass("Humanoid")

            if part and hum and hum.Health > 0 then
                local screenPos, visible = Camera:WorldToViewportPoint(part.Position)
                if visible then
                    local dist = (Vector2.new(screenPos.X, screenPos.Y) - mousePos).Magnitude
                    if dist < shortest then
                        shortest = dist
                        closest = plr
                    end
                end
            end
        end
    end

    return closest
end

-- =========================
-- INPUT (RIGHT CLICK)
-- =========================
UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.UserInputType == Enum.UserInputType.MouseButton2 then
        Holding = true
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton2 then
        Holding = false
    end
end)

-- =========================
-- AIM LOOP
-- =========================
RunService.RenderStepped:Connect(function()
    if not Holding then return end
    if not _G.AimbotEnabled then return end

    local target = GetClosestMurder()
    if not target or not target.Character then return end

    local part = target.Character:FindFirstChild(_G.AimPart)
    if not part then return end

    TweenService:Create(
        Camera,
        TweenInfo.new(_G.Sensitivity, Enum.EasingStyle.Sine, Enum.EasingDirection.Out),
        {CFrame = CFrame.new(Camera.CFrame.Position, part.Position)}
    ):Play()
end)

print("âœ… MM2 Murder Lock Aimbot Loaded")


-- ======================================
-- SMOOTH AUTO AIM KNIFE (NO SLIDER)
-- ======================================
local smoothAimKnife = false
local SMOOTH_SPEED = 0.12 -- nilai aman & halus

MainSection:NewToggle(
    "Auto Aim Knife",
    "Smooth auto aim saat pegang knife",
    function(state)
        smoothAimKnife = state
    end
)

local Camera = workspace.CurrentCamera

local function isHoldingKnife()
    return player.Character and player.Character:FindFirstChild("Knife")
end

local function getNearestTarget()
    local char = player.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return end
    local hrp = char.HumanoidRootPart

    local nearest, minDist = nil, math.huge

    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= player
            and plr.Character
            and plr.Character:FindFirstChild("HumanoidRootPart") then

            local hum = plr.Character:FindFirstChildOfClass("Humanoid")
            if hum and hum.Health > 0 then
                local dist = (hrp.Position - plr.Character.HumanoidRootPart.Position).Magnitude
                if dist < minDist then
                    minDist = dist
                    nearest = plr
                end
            end
        end
    end

    return nearest
end

RunService.RenderStepped:Connect(function()
    if not smoothAimKnife then return end
    if not isHoldingKnife() then return end

    local target = getNearestTarget()
    if not target or not target.Character then return end

    local targetHRP = target.Character:FindFirstChild("HumanoidRootPart")
    if not targetHRP then return end

    local camCF = Camera.CFrame
    local targetCF = CFrame.new(camCF.Position, targetHRP.Position)

    -- SMOOTH AIM (HALUS, TIDAK SNAP)
    Camera.CFrame = camCF:Lerp(targetCF, SMOOTH_SPEED)
end)

-- ================================
-- Auto teleport lobby (INNOCENT ONLY)
-- ================================

-- SERVICES
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer

-- SETTING
local autoFarm = false
local farmDelay = 100
local COIN_NAME = "Coin"

-- ================================
-- GET CHARACTER
-- ================================
local function getHRP()
    local char = player.Character
    if not char then return nil end
    return char:FindFirstChild("HumanoidRootPart")
end

-- ================================
-- CEK INNOCENT
-- ================================
local function isInnocent()
    local char = player.Character
    if not char then return false end

    -- MM2 role check
    if char:FindFirstChild("Knife") then return false end
    if char:FindFirstChild("Gun") then return false end

    return true
end

-- ================================
-- AUTO FARM LOOP (RINGAN)
-- ================================
task.spawn(function()
    while task.wait(0.25) do
        if not autoFarm then continue end
        if not isInnocent() then continue end

        local hrp = getHRP()
        if not hrp then continue end

        for _, obj in ipairs(Workspace:GetDescendants()) do
            if not autoFarm then break end
            if not isInnocent() then break end

            if obj:IsA("BasePart") and obj.Name == COIN_NAME then
                -- teleport ke coin
                hrp.CFrame = obj.CFrame + Vector3.new(0, 2.5, 0)

                -- sentuh coin
                pcall(function()
                    firetouchinterest(hrp, obj, 0)
                    firetouchinterest(hrp, obj, 1)
                end)

                task.wait(farmDelay)
            end
        end
    end
end)

-- ================================
-- AUTO TAB (KAVO UI)
-- ================================
local MainSection = MainTab:NewSection("Auto Farm")

MainSection:NewToggle(
    "Auto Win Innocent",
    "Auto collect coin saat round (no lobby)",
    function(state)
        autoFarm = state
    end
)


-- ================================
-- Auto teleport lobby
-- ================================

-- SERVICES
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer

-- SETTING
local autoFarm = false
local farmDelay = 0.15 -- makin kecil makin cepat (jangan terlalu kecil)
local COIN_NAME = "Coin" -- MM2 coin

-- ================================
-- GET CHARACTER
-- ================================
local function getHRP()
    local char = player.Character
    if not char then return nil end
    return char:FindFirstChild("HumanoidRootPart")
end

-- ================================
-- AUTO FARM LOOP (RINGAN)
-- ================================
task.spawn(function()
    while task.wait(0.25) do
        if not autoFarm then continue end

        local hrp = getHRP()
        if not hrp then continue end

        for _, obj in ipairs(Workspace:GetDescendants()) do
            if not autoFarm then break end

            if obj:IsA("BasePart") and obj.Name == COIN_NAME then
                -- teleport ke coin
                hrp.CFrame = obj.CFrame + Vector3.new(0, 2.5, 0)

                -- sentuh coin
                pcall(function()
                    firetouchinterest(hrp, obj, 0)
                    firetouchinterest(hrp, obj, 1)
                end)

                task.wait(farmDelay)
            end
        end
    end
end)

-- ================================
-- Tab teleport
-- ================================
local TeleportTab = Window:NewTab("Teleport")
local TeleportSection = TeleportTab:NewSection("Teleport")

TeleportSection:NewToggle(
    "Auto Lobby",
    "Auto teleport coin saat innocent",
    function(state)
        autoFarm = state
    end
)

--==================================================
-- MM2 AUTO COIN FARM (FINAL CLEAN STABLE)
--==================================================

getgenv().AutoFarmEnabled = false

--========================
-- SERVICES
--========================
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local StarterGui = game:GetService("StarterGui")

local player = Players.LocalPlayer
local PlayerGui = player:WaitForChild("PlayerGui")

--========================
-- SAFE NOTIFY
--========================
local function notify(t, m, d)
    pcall(function()
        StarterGui:SetCore("SendNotification", {
            Title = t,
            Text = m,
            Duration = d or 2
        })
    end)
end

--========================
-- CHARACTER HELPERS
--========================
local function getCharacter()
    return player.Character or player.CharacterAdded:Wait()
end

local function getRoot()
    local char = getCharacter()
    return char and char:FindFirstChild("HumanoidRootPart")
end

--========================
-- ROUND CHECK (SAFE)
--========================
local function inRound()
    local gui = PlayerGui:FindFirstChild("MainGUI")
    if not gui then return false end
    local gameGui = gui:FindFirstChild("Game")
    if not gameGui then return false end
    return gameGui.Timer.Visible or gameGui.EarnedXP.Visible
end

--========================
-- MAP + COIN FINDER
--========================
local function getMap()
    for _, v in ipairs(workspace:GetChildren()) do
        if v:IsA("Model") and v:FindFirstChild("Spawns") and v.Name ~= "Lobby" then
            return v
        end
    end
end

--========================
-- OCTREE
--========================
local Octree = loadstring(game:HttpGet(
    "https://raw.githubusercontent.com/Sleitnick/rbxts-octo-tree/main/src/init.lua",
    true
))()

--========================
-- RUNTIME STATE
--========================
local rt = {
    octree = Octree.new(),
    touched = {},
    coinContainer = nil,
    radius = 500,
    speed = 25
}

--========================
-- CLEANUP
--========================
local function cleanup()
    rt.octree:ClearAllNodes()
    table.clear(rt.touched)
end

--========================
-- COIN SYSTEM
--========================
local function markCoin(coin)
    rt.touched[coin] = true
    local node = rt.octree:FindFirstNode(coin)
    if node then
        rt.octree:RemoveNode(node)
    end
end

local function populateCoins()
    rt.octree:ClearAllNodes()

    if not rt.coinContainer then return end

    for _, d in ipairs(rt.coinContainer:GetDescendants()) do
        if d:IsA("TouchTransmitter") then
            local coin = d.Parent
            if coin and not rt.touched[coin] then
                rt.octree:CreateNode(coin.Position, coin)
            end
        end
    end
end

--========================
-- MOVE FUNCTION
--========================
local function moveTo(pos)
    local root = getRoot()
    if not root then return end

    local start = root.Position
    local dist = (start - pos).Magnitude
    local dur = math.max(dist / rt.speed, 0.05)
    local t0 = tick()

    while tick() - t0 < dur do
        local rootNow = getRoot()
        if not rootNow then break end
        local a = math.clamp((tick() - t0) / dur, 0, 1)
        rootNow.Parent:PivotTo(CFrame.new(start:Lerp(pos, a)))
        RunService.Heartbeat:Wait()
    end
end

--========================
-- MAIN AUTOFARM LOOP
--========================
local function collectCoins()
    notify("AutoFarm", "Started", 1.5)

    while getgenv().AutoFarmEnabled do
        if not inRound() then
            task.wait(1)
            continue
        end

        local root = getRoot()
        if not root then
            task.wait(0.2)
            continue
        end

        -- AUTO FIND / REBUILD COINS
        if not rt.coinContainer or not rt.coinContainer.Parent then
            local map = getMap()
            rt.coinContainer = map and map:FindFirstChild("CoinContainer")
            if rt.coinContainer then
                populateCoins()
            end
            task.wait(0.5)
            continue
        end

        local nearest = rt.octree:GetNearest(root.Position, rt.radius, 1)
        if not nearest or not nearest[1] then
            populateCoins()
            task.wait(0.4)
            continue
        end

        local coin = nearest[1].Object
        if not coin or not coin.Parent then
            markCoin(coin)
            continue
        end

        moveTo(coin.Position)
        markCoin(coin)

        task.wait(0.1)
    end

    cleanup()
    notify("AutoFarm", "Stopped", 1.5)
end

--========================
-- GUI TOGGLE
--========================
local gui = Instance.new("ScreenGui")
gui.Name = "AutoFarmGui"
gui.ResetOnSpawn = false
gui.Parent = PlayerGui

local btn = Instance.new("TextButton")
btn.Size = UDim2.new(0, 160, 0, 45)
btn.Position = UDim2.new(0, 20, 0, 200)
btn.BackgroundColor3 = Color3.fromRGB(60, 0, 90)
btn.TextColor3 = Color3.new(1,1,1)
btn.Font = Enum.Font.GothamBold
btn.TextSize = 14
btn.Text = "AUTOFARM : OFF"
btn.Active = true
btn.Draggable = true
btn.Parent = gui

btn.MouseButton1Click:Connect(function()
    getgenv().AutoFarmEnabled = not getgenv().AutoFarmEnabled
    btn.Text = getgenv().AutoFarmEnabled and "AUTOFARM : ON" or "AUTOFARM : OFF"

    if getgenv().AutoFarmEnabled then
        task.spawn(collectCoins)
    end
end)

--==================================================
-- ANTI IDLE / ANTI AFK (XENO SAFE)
--==================================================

local Players = game:GetService("Players")
local VirtualUser = game:GetService("VirtualUser")

local player = Players.LocalPlayer

-- Roblox idle detector
player.Idled:Connect(function()
    VirtualUser:Button2Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
    task.wait(1)
    VirtualUser:Button2Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
end)

task.spawn(function()
    while true do
        task.wait(60) -- tiap 1 menit
        local char = Players.LocalPlayer.Character
        local root = char and char:FindFirstChild("HumanoidRootPart")
        if root then
            root.CFrame = root.CFrame * CFrame.new(0, 0, 0.05)
        end
    end
end)
